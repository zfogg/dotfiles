#!/usr/bin/env zsh -e
#   ~/.dotfiles/.aliases


alias rm='trash'

alias vim="$EDITOR"
alias  vi="$EDITOR"
alias   v="$EDITOR"

[[ "$OSX" == "$TRUE" ]] \
    && alias python3="python3.6.2" \
    || alias python3="python3.7.4"

alias    zshrc='$EDITOR $ZDOTDIR/.zshrc'
alias   zshenv='$EDITOR $ZDOTDIR/.zshenv'
alias   zlogin='$EDITOR $ZDOTDIR/.zlogin'
alias zprofile='$EDITOR $ZDOTDIR/.zprofile'
alias    vimrc='$EDITOR ${DOTFILES:-$HOME}/.vim/vimrc'

if command_exists zshz; then
  compdef _zshz z=zshz
fi

alias ql='quick-look'

function() { # ls
  if command_exists lsd; then
    alias lsd >/dev/null && unalias lsd
    local LSPRG_PRG='lsd'
    local LSPRG_ARGS="`
      printf ' --blocks=date,size,user,name'
      printf ' --human-readable --size=short'
      printf ' --timesort --date=relative --reverse'
      printf ' --group-dirs=first --classify' `"
  else
    local LSPRG_PRG="`which -p gls ls | head -n1 | xargs basename`"
    local LSPRG_ARGS='-LhHGstc'
    if [[ "$LSPRG_PRG" == 'gls' ]]; then
      LSPRG_ARGS+="`
        printf ' --color=auto'
        printf ' --group-directories-first'
        printf ' --quoting-style=shell-always' `"
    fi
  fi

  alias ls="${LSPRG_PRG} ${LSPRG_ARGS}"
  alias  l='ls -1'
  alias ll='ls -1l'
  alias la='nowrap ls -1lA'
  alias lt='ls -1Al --tree --depth=2'
}

alias sudo='nocorrect sudo -E '

alias   s='sudo'
compdef s=sudo

alias llog='command -p log'

alias ..='cd ..'
alias ...='cd ../..'

alias less='$PAGER'
alias zless='$PAGER'

alias htop='htop -u $USER'

alias   rg="${GREPPRG}"      ; compdef   rg="${GREPPRG}"
alias  rgg="${GREPPRG} -C=0" ; compdef  rgg="${GREPPRG}"
alias grep="${GREPPRG} -C=0" ; compdef grep="${GREPPRG}"

# pip2 install pygments
#alias pcat='pygmentize -O style=monokai -f 256 -g'
alias pcat='pygmentize -O style=base16-default-dark -f 256 -g'
alias c='pcat'
compdef pcat=pygmentize
compdef    c=pygmentize


[[ "$OSX" == "$TRUE" ]] \
  && alias ping='grc ping -C -c 3 -i 0.2 -W 5000 -t 5 -Q' \
  || alias     ping='ping    -c 3'

alias fs='du -shL'

alias idea='$EDITOR ~/Dropbox/ideas.md'

alias colortest='~/.config/base16-shell/colortest'

function pyeve() { eval "`~/bin/pyeve ${1:-';'}`" }

#alias chmod='command -p chmod'
#alias chown='command -p chown'
#alias chgrp='command -p chgrp'


# shell output line wrapping
alias wrapoff='tput rmam'
alias  wrapon='tput smam'
function nowrap() {
  [ -t 1 ] && tput rmam
  "$@"; local ret="$?"
  [ -t 1 ] && tput smam
  return "$ret"
}
alias nowrap='nowrap '


# git
alias gc='git commit'
alias gca='git commit -a'
alias  gd='git diff'
alias gdd='git diff --color-words'
alias gl='git log'
alias gp='git push'
alias grv='git remote -v'
alias gst='git status'
alias ga='git add'
alias gco='git checkout'
alias gcm='git checkout master'

alias ghclone='cd "$(git gh `pbpaste | tr "'"/"'" "'"  "'"`)" && :'


if [[ "${OSX:-0}" == "${TRUE:-1}" ]]; then
    alias get='ghq get -u -p --shallow "`pbpaste`"; echo'
elif [[ "${LINUX:-0}" == "${TRUE:-1}" ]]; then
    alias get='ghq get -u -p --shallow "`xclip -out`"; echo'
fi

alias tree='tree --du --si --filelimit 512 -I "node_modules|bower_components|vendor|bundle|target|build|public" -L 5'

alias phpcs='phpcs --standard=ruleset.xml --extensions=php --ignore=node_modules,bower_components,vendor -n -s'


function echoer() {
  printf "%s\n" "$*" >&2;
}


function gencomp_all() {
  for p in $path; do command -p ls $p; done |\
    uniq |\
    { while read c; do gencomp $c; done }
}


function trnl() {
    tr "${1:-':'}" '\n'
}

function mktempf() {
    fpref="${DOTFILES_PACKAGE:-"$USER"_`basename $SHELL`}"
    tempf="${fpref}.${1:-$0}.XXXX"
    mktemp -t "${tempf}" 2>/dev/null || (
        read -d '' errmsg<<-"EOF"
			%s - error
			    \$TMPDIR = "%s"
			    \$tempf  = "%s"
		EOF
        echo "$0" "$TMPDIR" "$tempf" | echoer
    )
}

function ppvar() {
    tempf=`mktempf`
    exec 3>&2 2>$tempf
    var_name=`echo "${1:-PATH}" | tr -d '$'`
    echoer "$0"' - pretty print shell env vars'
    echoer $'\tvar name\t-> '"$var_name"''
    plines=$(eval echo \${$var_name} | trnl "${2:-':'}")
    echoer $'\titem count\t-> '"$(echo "$plines" | wc -l)"
    echo "$plines"
    exec 2>&3 3>&-
    xargs -0 printf '\n%s\n' >&2 < $tempf
}


function npm-do {
    (PATH=$(npm bin):$PATH; eval $@;)
}


function aliasof() {
  alias "$1" |\
    sed -E "s|vim='?(.*)'?|\1|"
}


# pyenv
function gpip()  {PIP_REQUIRE_VIRTUALENV='' pip  "$@"}
function gpip2() {PIP_REQUIRE_VIRTUALENV='' pip2 "$@"}
function gpip3() {PIP_REQUIRE_VIRTUALENV='' pip3 "$@"}

alias pyenv-init='eval "$(pyenv init -)"; eval "$(pyenv virtualenv-init -)"'
