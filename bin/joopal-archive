#!/usr/bin/env zsh -e


autoload -Uz bin-abort ba-err echoer
trap 'bin-abort' ERR


n="${1:-/dev/null/invalid}"
if [[ ! -e "$n" ]]; then
    >&2 echo 'ðŸ”´  no file '"'$n'"' ðŸ˜©' && exit 1
fi


d="$(date +%Y%m%d-%H%M%S)"
f="$(basename "$(readlink -f "$n")")"."$d".tar.gz


echo 'tar . . .'
tar czfv "$f" "$n"
echo '. . . tar'; echo

echo 'gpg . . .'
gpg --sign --symmetric \
    --output "$f".gpg "$f"
echo '. . . gpg'; echo

echo 'du . . .'
du -s --si "$n" "$f"*
echo '. . . du'; echo

echo 'rm '"$f"
rm "$f"
echo

