#!/usr/bin/zsh -e


source ~/.zsh/site-functions/bin-abort
trap 'bin-abort' ERR


eval "$(pyenv init -)"
local pip_reqs="${PYENV_ROOT}/neovim-packages"
for py_v in 2 3; do
#for py_v in 3; do
    pyenv activate neovim"$py_v"
    pyenv exec pip install --quiet --requirement "${pip_reqs}${py_v}"
done


local cargo_reqs=(
    racer
    clippy
)
for p in $cargo_reqs; do
    cargo install --quiet "$p" 2>/dev/null || true
done


local npm_reqs=(
    jsonlint
    tern
    neovim
)
npm --silent install --global ${npm_reqs}


local goget_reqs=(
    github.com/nsf/gocode
)
for r in ${goget_reqs}; do
    go get -u "$r"
done


local gem_reqs=(
    neovim
)
for r in ${gem_reqs}; do
    gem install "$r"
done


# compile editor binaries last
#brew update
#brew upgrade vim    || true
#brew upgrade neovim || true


$EDITOR +PlugUpgrade +qall
$EDITOR +PlugClean +PlugInstall +qall
$EDITOR +PlugUpdate
